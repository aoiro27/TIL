https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/chain-prompts

# 複雑なタスクは「プロンプトチェーン」で段階的に分割しよう

## 概要

- 1つの巨大なプロンプトで複雑なタスクを処理しようとすると、Claudeは手順を飛ばしたり、内容が抜けたりしやすくなります。
- 「Chain of Thought（CoT）」も有効ですが、**複数の明確なステップが必要なタスク**では「プロンプトチェーン（プロンプトの分割・連結）」が最適です。
- **プロンプトチェーン**とは、タスクを小さなサブタスクに分け、各ステップごとにClaudeを呼び出す方法です。

---

## なぜプロンプトチェーンを使うのか？

1. **精度向上**：各サブタスクに集中できるのでミスが減る
2. **明確さ**：指示がシンプルになり、出力も安定する
3. **デバッグ容易**：どのステップで問題が起きたか特定しやすい

---

## どんな時に有効？

- 複数ステップのリサーチや要約、ドキュメント分析、反復的なコンテンツ生成など
- 変換・要約・分析など複数の変換工程が必要なとき
- 各工程で異なる指示やフォーマット、チェックが必要なとき

---

## プロンプトチェーン設計のコツ

1. **タスクをサブタスクに分割**  
   例：  
   - 法務レビュー → 「問題点抽出」→「メールドラフト作成」→「レビュー」
   - コンテンツ生成 →「リサーチ」→「アウトライン」→「ドラフト」→「編集」

2. **XMLタグなどで中間出力を明示**  
   各ステップの出力をXMLタグ等で囲み、次のプロンプトに渡す

3. **サブタスクは「1つの明確なゴール」に絞る**

4. **必要に応じて各ステップを個別にチューニング**

---

## 例：法務契約書レビュー

### チェーンなし（1プロンプトで全部やる）
- Claudeが「提案修正」など一部の指示を見落としやすい

### チェーンあり（2段階に分割）

#### プロンプト1
- 「契約書のリスクを抽出し、&lt;risks&gt;タグで出力せよ」
- 出力例（CONCERNS）：  
  ```
  1. データプライバシー...
  2. SLA...
  3. 賠償責任...
  ```

#### プロンプト2
- 「上記のリスクをもとに、ベンダー向けメールをドラフトせよ」
- ClaudeはCONCERNSタグを受け取り、抜け漏れなくメール案を作成

---

## 例：自己修正チェーン（セルフコレクション）

- ステップ1：要約生成
- ステップ2：その要約のレビュー・フィードバック
- ステップ3：フィードバックを反映した要約の再生成

---

## その他の応用例

- **コンテンツ制作パイプライン**：リサーチ → アウトライン → 下書き → 校正
- **データ処理**：抽出 → 変換 → 分析 → 可視化
- **意思決定**：情報収集 → 選択肢列挙 → 各案の分析 → 推薦

---

## ポイント

- 各サブタスクは「Claudeが一度に集中できる」くらい小さく
- ステップごとに出力をタグで囲むと、次のプロンプトへの受け渡しが簡単
- 並列処理できる部分は複数プロンプトを同時に走らせると効率化

---

## 参考

- [プロンプトライブラリ](https://docs.anthropic.com/en/resources/prompt-library/library)
- [GitHubプロンプトチュートリアル](https://github.com/anthropics/prompt-eng-interactive-tutorial)

---

複雑なタスクは「プロンプトチェーン」で段階的に分割し、Claudeのパフォーマンスと信頼性を最大化しましょう。